<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cadastro</title>
  <link rel="stylesheet" href="/cadastro.css" />
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
</head>
<body>
  <div class="container">
    <h2>Preencha as informações abaixo para se cadastrar na plataforma.</h2>

    <form id="cadastroForm">
      <label for="nome">Nome social</label>
      <input type="text" id="nome" required />

      <label for="pronome">Pronome</label>
      <input type="text" id="pronome" placeholder="Ela/dela" required />

      <label for="genero">Identidade de gênero</label>
      <input type="text" id="genero" placeholder="Mulher trans" required />

      <label for="nascimento">Data de nascimento</label>
      <input type="date" id="nascimento" required />

      <label for="email">E-mail</label>
      <input type="email" id="email" required />

      <label for="senha">Senha</label>
      <input type="password" id="senha" required />

      <button type="submit">Cadastrar</button>
    </form>

    <p>Já tem uma conta? <a href="login.html">Faça login</a></p>

    <hr>
    <h3>Ou cadastre-se com Google:</h3>

    <div id="g_id_onload"
         data-client_id="577278743325-vi8qf66g0945elfuosnrn729gb8196ui.apps.googleusercontent.com"
         data-context="signup"
         data-ux_mode="popup"
         data-callback="handleCredentialResponse">
    </div>

    <div class="g_id_signin"
         data-type="standard"
         data-shape="rectangular"
         data-theme="outline"
         data-text="sign_in_with"
         data-size="large">
    </div>
  </div>

  <script>
    document.getElementById("cadastroForm").addEventListener("submit", function(event) {
      event.preventDefault();

      const data = {
        nome: document.getElementById("nome").value.trim(),
        pronome: document.getElementById("pronome").value.trim(),
        genero: document.getElementById("genero").value.trim(),
        nascimento: document.getElementById("nascimento").value,
        email: document.getElementById("email").value.trim(),
        senha: document.getElementById("senha").value.trim()
      };

      if (Object.values(data).every(Boolean)) {
        fetch("/cadastro", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(data)
        })
        .then(response => {
          if (response.ok) {
            window.location.href = "login.html";
          } else {
            alert("Erro ao cadastrar.");
          }
        });
      } else {
        alert("Preencha todos os campos.");
      }
    });

    function handleCredentialResponse(response) {
      const userData = jwt_decode(response.credential);
      alert(`Login com Google realizado! Bem-vindo(a), ${userData.name}`);
      window.location.href = "login.html";
    }
  </script>
</body>
</html>
